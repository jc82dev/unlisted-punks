(function(e){const t=1e4,a={MALE:29527680,FEMALE:6092800},n=(e,t)=>e.localeCompare(t),s=(e,t)=>e===t?0:"none"===e?-1:"none"===t?1:e.localeCompare(t);e.SPRITES={male:{skin:{alien:1,ape:3,zombie:13,"human-lighter":11,"human-light":10,"human-dark":8,"human-darker":9},blemish:{none:null,mole:84,"rosy-cheeks":85,spots:86},ear:{none:null,earring:87},eyes:{none:null,"3d-glasses":88,"big-shades":89,"classic-shades":90,"clown-eyes-blue":91,"clown-eyes-green":92,"eye-mask":93,"eye-patch":94,"horned-rim-glasses":95,"nerd-glasses":96,"regular-shades":97,"small-shades":98,vr:99},"facial-hair":{none:null,"big-beard":100,chinstrap:101,"front-beard-dark":102,"front-beard":103,goat:104,handlebars:105,"luxurious-beard":106,mustache:107,muttonchops:108,"normal-beard-black":109,"normal-beard":110,"shadow-beard":111},head:{none:null,bandana:112,beanie:113,"cap-forward":114,cap:115,"clown-hair-green":116,"cowboy-hat":117,"crazy-hair":118,"do-rag":119,fedora:120,"frumpy-hair":121,headband:122,hoodie:123,"knitted-cap":124,"messy-hair":125,"mohawk-dark":126,"mohawk-thin":127,mohawk:128,"peak-spike":129,"police-cap":130,"purple-hair":131,"shaved-head":132,"stringy-hair":133,"top-hat":134,"vampire-hair":135,"wild-hair":136},mouth:{none:null,"buck-teeth":137,smile:143,frown:141},"mouth-accessory":{none:null,cigarette:138,pipe:139,vape:140,"medical-mask":142},neck:{none:null,"gold-chain":144,"silver-chain":145},nose:{none:null,"clown-nose":146}},female:{skin:{alien:0,ape:2,zombie:12,"human-lighter":7,"human-light":6,"human-dark":4,"human-darker":5},blemish:{none:null,mole:14,"rosy-cheeks":15,spots:16},ear:{none:null,earring:17},eyes:{none:null,"3d-glasses":18,"big-shades":19,"blue-eye-shadow":20,"classic-shades":21,"clown-eyes-blue":22,"clown-eyes-green":23,"eye-mask":24,"eye-patch":25,"green-eye-shadow":26,"horned-rim-glasses":27,"nerd-glasses":28,"purple-eye-shadow":29,"regular-shades":30,"small-shades":31,vr:32,"welding-goggles":33},head:{none:null,bandana:34,beanie:35,"blonde-bob":36,"blonde-short":37,"cap-forward":38,cap:39,"clown-hair-green":40,"cowboy-hat":41,"crazy-hair":42,"dark-hair":43,"do-rag":44,fedora:45,"frumpy-hair":46,"half-shaved":47,headband:48,hoodie:49,"knitted-cap":50,"messy-hair":51,"mohawk-thin":52,"mohawk-dark":53,mohawk:54,"orange-side":55,pigtails:56,"pilot-helmet":57,"pink-with-hat":58,"police-cap":59,"purple-hair":60,"red-mohawk":61,"shaved-head":62,"straight-hair-blonde":63,"straight-hair-dark":64,"straight-hair":65,"stringy-hair":66,"tassle-hat":67,tiara:82,"top-hat":68,"wild-blonde":69,"wild-hair":70,"wild-white-hair":71},mouth:{none:null,"black-lipstick":75,"hot-lipstick":76,"purple-lipstick":78},"mouth-accessory":{none:null,cigarette:72,pipe:73,vape:74,"medical-mask":77},neck:{none:null,choker:79,"gold-chain":80,"silver-chain":81},nose:{none:null,"clown-nose":83}}},e.ATTRIBUTES_LIST=["skin","blemish","ear","head","mouth","neck","nose","eyes","facial-hair","mouth-accessory"],e.ATTRIBUTES={base:["male-alien","male-ape","male-zombie","male-human-lighter","male-human-light","male-human-dark","male-human-darker","female-alien","female-ape","female-zombie","female-human-lighter","female-human-light","female-human-dark","female-human-darker"],blemish:["mole","rosy-cheeks","spots"],ear:["earring"],eyes:["3d-glasses","big-shades","blue-eye-shadow","classic-shades","clown-eyes-blue","clown-eyes-green","eye-mask","eye-patch","green-eye-shadow","horned-rim-glasses","nerd-glasses","purple-eye-shadow","regular-shades","small-shades","vr","welding-goggles"],"facial-hair":["big-beard","chinstrap","front-beard","front-beard-dark","goat","handlebars","luxurious-beard","mustache","muttonchops","normal-beard","normal-beard-black","shadow-beard"],head:["bandana","beanie","blonde-bob","blonde-short","cap","cap-forward","clown-hair-green","cowboy-hat","crazy-hair","dark-hair","do-rag","fedora","frumpy-hair","half-shaved","headband","hoodie","knitted-cap","messy-hair","mohawk","mohawk-dark","mohawk-thin","orange-side","peak-spike","pigtails","pilot-helmet","pink-with-hat","police-cap","purple-hair","red-mohawk","shaved-head","straight-hair","straight-hair-blonde","straight-hair-dark","stringy-hair","tassle-hat","tiara","top-hat","vampire-hair","wild-blonde","wild-hair","wild-white-hair"],mouth:["black-lipstick","buck-teeth","frown","hot-lipstick","purple-lipstick","smile"],"mouth-accessory":["cigarette","pipe","vape","medical-mask"],neck:["choker","gold-chain","silver-chain"],nose:["clown-nose"]},e.isValidTokenId=(e=>{let n=!1;return isNaN(e)||(e=parseInt(e),e-=t,n=0<=e&&e<a.MALE+a.FEMALE),n}),e.labelize=(e=>e?e.replace(/-/g," ").replace(/(^\w{1})|(\s+\w{1})/g,e=>e.toUpperCase()):""),e.getTokenId=(o=>{const i=o.gender;let r="female"===i?a.MALE:0;const l=e.SPRITES[i],d=Object.keys(e.SPRITES[i]).sort(n);let c=1;for(let e=d.length-1;e>=0;e--){const t=d[e],a=o[t]||"none",n=Object.keys(l[t]).sort(s),i=n.indexOf(a||null);if(i<0)throw new Error(`"${a}" is not a valid value for attribute "${t}"`);{r+=i*c;const e=n.length;c*=e}}return r+t}),e.getPunkFromTokenId=(o=>{o-=t;const i={gender:null};o<a.MALE?i.gender="male":(i.gender="female",o-=a.MALE);const r=i.gender,l=e.SPRITES[r],d=Object.keys(e.SPRITES[r]).sort(n),c=[];let h=1;for(let e=d.length-1;e>=0;e--){const t=d[e],a=Object.keys(l[t]),n=a.length;c.unshift(h),h*=n}for(let e=0;e<d.length;e++){const t=d[e],a=c[e],n=Math.floor(o/a),r=Object.keys(l[t]).sort(s);i[t]=r[n],"none"===i[t]&&(i[t]=null),o-=n*a}return i})})("undefined"==typeof window?module.exports:window),(()=>{const e={API_ENDPOINT:"https://europe-west1-unlisted-punks.cloudfunctions.net/api"},t="0x4",a="Select...",n={METAMASK_NOT_FOUND:'You need an Ethereum wallet to mint NFTs! You can download metamask <a target="_blank" href="https://metamask.io/download/">here</a>',MINTING_IN_PROGRESS:'<img src="/assets/img/loader.gif"><span>It can take a few seconds...</span>',MINT_SUCCESS:'Punks minted successfully! Click <a target="_blank" href="//rinkeby.etherscan.io/tx/{tx}">here</a> to check the transaction on etherscan'},s={gender:"male",skin:"human-light",blemish:null,ear:null,eyes:null,"facial-hair":null,head:null,mouth:null,"mouth-accessory":null,neck:null,nose:null},o={...s};let i=!1,r=null,l=null,d=null;const c=document.querySelector("#modal"),h=c.querySelector("#modal .modal-content"),m=document.querySelector("#modalMessage"),u=document.querySelector("#modalMessage .modal-content"),g=Array.from(document.querySelectorAll(".combo")),w=document.querySelector("#btnCloseModal"),p=document.querySelector("#btnAddToCart"),y=document.querySelector("#btnConnectWallet"),b=document.querySelector("#btnMintFirstButton"),k=document.querySelector(".result"),f=document.querySelector("#cartItems"),v=document.querySelector("#btnMint"),S=document.querySelector("#closeMessageButton"),E=document.querySelector("#cartTotal"),T=document.querySelector(".wallet"),I=document.querySelector(".wallet-list"),P=document.querySelector(".builder"),$=()=>Array.from(f.querySelectorAll(".item")).map(e=>JSON.parse(decodeURIComponent(e.dataset.mintrequest))),A=async t=>{window.progress.start(),i=!0,C();let a=null;try{const n=await fetch(`${e.API_ENDPOINT}?method=getPunk&tokenId=${t}`);if(n.ok){const e=await n.json();return e}a=await n.text()}catch(e){a=e.message}finally{i=!1,window.progress.stop(),C(a)}},M=(e,t,a="var(--punk--comboSize)")=>e&&t?"gender"!==e?SPRITES[o.gender][e]?`calc(-${SPRITES[o.gender][e][t]} * ${a})`:null:`calc(-${SPRITES[t].skin[o.skin]} * ${a})`:null,L=e=>{e?(document.body.style.overflow="hidden",c.classList.add("visible")):(document.body.style.overflow="initial",c.classList.remove("visible"))},q=(e,t="success")=>{e?(document.body.style.overflow="hidden",m.dataset.type=t,m.classList.add("visible"),u.innerHTML=e):(document.body.style.overflow="initial",m.classList.remove("visible"),u.innerHTML="")},R=e=>{const t=e.dataset.combo,n=o[t];e.dataset.empty=!n;const s=M("skin",o.skin);e.innerHTML=`\n    <div class="layer-container" style="background-image:${["skin","gender"].includes(t)?"":"url('assets/img/sprites.png')"};background-position:${s}">\n        <img class="layer" src="assets/img/sprites.png" style="object-position:${M(t,n)}" />\n    </div>\n    <div class="label-container">\n        <div class="label-head">${window.labelize(e.dataset.combo)}</div>\n        <div class="label">${n?window.labelize(n):a}</div>\n    </div>`,e.addEventListener("click",()=>{document.body.style.overflow="hidden";const e=M("skin",o.skin);let a=null;a="gender"===t?{male:window.SPRITES.male.skin[o.skin],female:window.SPRITES.female.skin[o.skin]}:window.SPRITES[o.gender][t];let n='<div class="options">';Object.keys(a).map(e=>({id:e,pos:a[e]})).forEach(a=>{let s=!1;"none"!==a.id||"none"!==o[t]&&o[t]?"none"!==a.id&&SPRITES[o.gender][t]&&SPRITES[o.gender][t][a.id]&&(s=o[t]===a.id):s=!0,n+=`<div data-id="${a.id}" data-empty="${"none"===a.id}" data-selected="${s}" class="option" onclick="selectSprite('${t}','${a.id}')">\n                <div class="layer-container" style="background-image:${["skin","gender"].includes(t)?"":"url('assets/img/sprites.png')"};background-position:${e}">\n                    <img class="layer" src="assets/img/sprites.png" style="object-position:${M(t,a.id)}" />\n                </div>\n                <div class="label">${window.labelize(a.id)}</div>\n            </div>`}),n+="</div>",h.innerHTML=n,L(!0)})},N=()=>{const e=M("skin",o.skin);g.forEach(t=>{const n=t.dataset.combo,s=o.gender,i=o[n],r="gender"!==n&&!window.SPRITES[s][n];t.dataset.hidden=r;const l=!i||"none"===i;t.dataset.empty=l;const d=t.querySelector(".layer"),c=t.querySelector(".label");d.style=`object-position:${M(n,i)}`,d.dataset.empty=l,c.innerHTML=l?a:window.labelize(i);const h=t.querySelector(".layer-container");if(h.style.backgroundPosition=e,"gender"===n)newPos=e;else if(o[n]&&SPRITES[s][n]&&SPRITES[s][n][o[n]])newPos=M(n,o[n]);else{t.dataset.empty="true",newPos=M(n,null);const e=t.querySelector(".label");e.innerHTML=a}t.querySelector(".layer").style.objectPosition=newPos})},O=({node:e,state:t,imgSelector:a,size:n}={})=>{e=e||k,t=t||o,a=a||".result > img",n=n||"var(--punk--result)",t===o&&(e.dataset.tokenid=window.getTokenId(o));const s=Array.from(document.querySelectorAll(a));s.forEach(e=>{if(t[e.dataset.layer]&&"none"!==t[e.dataset.layer]&&window.SPRITES[t.gender][e.dataset.layer]&&window.SPRITES[t.gender][e.dataset.layer][t[e.dataset.layer]]){e.dataset.empty="false";const a=M(e.dataset.layer,t[e.dataset.layer],n);a?e.style.objectPosition=a:e.dataset.empty="true"}else e.dataset.empty="true"})},C=e=>{e&&q(e,"error");const t=parseInt(k.dataset.tokenid),a=$();i?(p.setAttribute("disabled",""),p.innerHTML="Loading..."):(p.innerHTML="Add to cart",a.find(e=>e.id===t)?p.setAttribute("disabled",""):p.removeAttribute("disabled")),a.length?(v.innerHTML=`Mint ${a.length} punk${a.length>1?"s":""}`,v.classList.remove("hidden"),i?v.setAttribute("disabled",""):v.removeAttribute("disabled")):v.classList.add("hidden");let n=0;a.forEach(e=>n+=e.price),E.innerHTML=parseFloat(n/1e9)},_=()=>{const e=parseInt(k.dataset.tokenid),t=$();e&&!t.includes(t=>e===t.id)&&(async()=>{const t=await A(e);if(t){const a=`https://infura-ipfs.io/ipfs/${t.imageCid}`;f.insertAdjacentHTML("beforeend",`<div data-tokenid="${t.tokenId}" data-price="${t.price}" data-mintrequest="${encodeURIComponent(JSON.stringify(t.mintRequest))}" class="item" title="#${t.tokenId}">\n              <div class="img-container"><img src="${a}" /></div>\n              <button>Remove</button>\n            </div>`),document.getElementById("favicon").setAttribute("href",a),C(),Object.assign(o,s),N(),O();const n=f.querySelector(`[data-tokenid="${e}"] > button`);n&&n.addEventListener("click",()=>{const t=f.querySelector(`[data-tokenid="${e}"]`);t&&t.remove(),C()})}})()},z=async()=>{let e=null;try{const t=await j(!0);if("not-found"===t)q(n.METAMASK_NOT_FOUND,"error");else if("connected"===t){if(l){const e=$();if(e.length){window.progress.start(),i=!0,C();const t=e.reduce((e,t)=>e+t.price,0);let a=await l.methods.mint(e).estimateGas({from:d});a+=Math.floor(.1*a);const s=await l.methods.mint(e).send({from:d,gas:a.toString(),value:r.utils.toWei(t.toString(),"gwei")}).once("transactionHash",()=>{q(n.MINTING_IN_PROGRESS,"mint")});q(n.MINT_SUCCESS.replace("{tx}",s.transactionHash)),f.innerHTML=""}}}else await j()}catch(t){e=t.message}finally{i=!1,window.progress.stop(),C(e)}},H=async()=>{const e=await j(!0);"not-found"===e&&q(n.METAMASK_NOT_FOUND,"error")},j=async a=>{window.progress.start();try{let n="not-found";if(Web3.givenProvider){r||(r=new Web3(Web3.givenProvider),Web3.givenProvider.on("connect",()=>j()),Web3.givenProvider.on("disconnect",()=>j()),Web3.givenProvider.on("chainChanged",()=>j()),Web3.givenProvider.on("accountsChanged",()=>j()));const s=await r.eth.getAccounts();if(d=s[0],!d&&a){const e=await Web3.givenProvider.request({method:"eth_requestAccounts"});d=e[0]}if(d){const s=await Web3.givenProvider.request({method:"eth_chainId"});if(s!==t)n="invalid-chain",a&&await Web3.givenProvider.request({method:"wallet_switchEthereumChain",params:[{chainId:t}]});else{if(!l){const t=await fetch(`${e.API_ENDPOINT}?method=getContract`);if(t.ok){const e=await t.json();l=new r.eth.Contract(e.abi,e.address)}else{const e=await t.text();if(e)throw new Error(e)}}l&&(n="connected")}}else n="disconnected"}return document.querySelector("body").dataset.web3=n,await F(),n}catch(e){q(e.message,"error")}finally{window.progress.stop()}},F=async()=>{if(l){T.dataset.status="loading";try{const e=[];let t=!1,a="";const n=k.innerHTML;do{let s=null;try{s=await l.methods.tokenOfOwnerByIndex(d,e.length).call({from:d});const o=window.getPunkFromTokenId(parseInt(s));a+=`<div class="wallet-item-container"><div data-tokenid="${s}" data-walletitem="${e.length}" class="wallet-item" title="#${s}">${n}</div><div class="wallet-item-tokenid">${s}</div></div>`,e.push({...o,base:`${o.gender}-${o.skin}`})}catch(e){t=!0}}while(!t);I.innerHTML=a,setTimeout(()=>{const t=Array.from(document.querySelectorAll(".wallet-item"));t.forEach((t,a)=>{const n=e[a],s="var(--punk--cartSize)",o=t,i=`[data-walletitem="${a}"] > img`;O({node:o,state:n,imgSelector:i,size:s})}),T.dataset.status=t.length?"connected":"empty"})}catch(e){T.dataset.status="disconnected",q(e.message,"error")}}else T.dataset.status="disconnected"};window.addEventListener("keydown",e=>{"Escape"===e.key&&L(!1)}),window.selectSprite=((e,t)=>{o[e]=t,O();M(e,t);const a=Array.from(c.querySelectorAll(".option"));a.forEach(e=>e.dataset.selected=e.dataset.id===t),L(!1),document.body.style.overflow="initial",N(),C()}),window.onWeb3Loaded=(async()=>{await j()}),g.forEach(e=>R(e)),p.addEventListener("click",_),v.addEventListener("click",z),y.addEventListener("click",H),b.addEventListener("click",()=>P.scrollIntoView({behavior:"smooth"})),w.addEventListener("click",()=>L(!1)),S.addEventListener("click",()=>q(null)),O()})(),(e=>{const t=200;let a=!1;const n=()=>{if(a){const t=(100-a.dataset.value)*(.1*Math.random());a.dataset.value=parseFloat(a.dataset.value)+t,a.style.width=`${a.dataset.value}%`,e.requestAnimationFrame(n.bind(null,a))}};e.progress={start(){a&&document.body.removeChild(a),a=document.createElement("div"),a.id="progress",a.dataset.value=0,document.body.appendChild(a),n(a)},stop:async()=>new Promise(n=>{const s=a;a=null,e.requestAnimationFrame(()=>{s&&(s.style.width="100%",setTimeout(()=>{document.body.removeChild(s),n()},t))})})}})(window);