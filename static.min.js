(function(e){const t=1e4,a={MALE:29527680,FEMALE:6092800};e.MAX_TOKENID=a.MALE+a.FEMALE-1,e.MIN_TOKENID=t;const n=(e,t)=>e.localeCompare(t),s=(e,t)=>e===t?0:"none"===e?-1:"none"===t?1:e.localeCompare(t);e.SPRITES={male:{skin:{alien:1,ape:3,zombie:13,"human-lighter":11,"human-light":10,"human-dark":8,"human-darker":9},blemish:{none:null,mole:84,"rosy-cheeks":85,spots:86},ear:{none:null,earring:87},eyes:{none:null,"3d-glasses":88,"big-shades":89,"classic-shades":90,"clown-eyes-blue":91,"clown-eyes-green":92,"eye-mask":93,"eye-patch":94,"horned-rim-glasses":95,"nerd-glasses":96,"regular-shades":97,"small-shades":98,vr:99},"facial-hair":{none:null,"big-beard":100,chinstrap:101,"front-beard-dark":102,"front-beard":103,goat:104,handlebars:105,"luxurious-beard":106,mustache:107,muttonchops:108,"normal-beard-black":109,"normal-beard":110,"shadow-beard":111},head:{none:null,bandana:112,beanie:113,"cap-forward":114,cap:115,"clown-hair-green":116,"cowboy-hat":117,"crazy-hair":118,"do-rag":119,fedora:120,"frumpy-hair":121,headband:122,hoodie:123,"knitted-cap":124,"messy-hair":125,"mohawk-dark":126,"mohawk-thin":127,mohawk:128,"peak-spike":129,"police-cap":130,"purple-hair":131,"shaved-head":132,"stringy-hair":133,"top-hat":134,"vampire-hair":135,"wild-hair":136},mouth:{none:null,"buck-teeth":137,smile:143,frown:141},"mouth-accessory":{none:null,cigarette:138,pipe:139,vape:140,"medical-mask":142},neck:{none:null,"gold-chain":144,"silver-chain":145},nose:{none:null,"clown-nose":146}},female:{skin:{alien:0,ape:2,zombie:12,"human-lighter":7,"human-light":6,"human-dark":4,"human-darker":5},blemish:{none:null,mole:14,"rosy-cheeks":15,spots:16},ear:{none:null,earring:17},eyes:{none:null,"3d-glasses":18,"big-shades":19,"blue-eye-shadow":20,"classic-shades":21,"clown-eyes-blue":22,"clown-eyes-green":23,"eye-mask":24,"eye-patch":25,"green-eye-shadow":26,"horned-rim-glasses":27,"nerd-glasses":28,"purple-eye-shadow":29,"regular-shades":30,"small-shades":31,vr:32,"welding-goggles":33},head:{none:null,bandana:34,beanie:35,"blonde-bob":36,"blonde-short":37,"cap-forward":38,cap:39,"clown-hair-green":40,"cowboy-hat":41,"crazy-hair":42,"dark-hair":43,"do-rag":44,fedora:45,"frumpy-hair":46,"half-shaved":47,headband:48,hoodie:49,"knitted-cap":50,"messy-hair":51,"mohawk-thin":52,"mohawk-dark":53,mohawk:54,"orange-side":55,pigtails:56,"pilot-helmet":57,"pink-with-hat":58,"police-cap":59,"purple-hair":60,"red-mohawk":61,"shaved-head":62,"straight-hair-blonde":63,"straight-hair-dark":64,"straight-hair":65,"stringy-hair":66,"tassle-hat":67,tiara:82,"top-hat":68,"wild-blonde":69,"wild-hair":70,"wild-white-hair":71},mouth:{none:null,"black-lipstick":75,"hot-lipstick":76,"purple-lipstick":78},"mouth-accessory":{none:null,cigarette:72,pipe:73,vape:74,"medical-mask":77},neck:{none:null,choker:79,"gold-chain":80,"silver-chain":81},nose:{none:null,"clown-nose":83}}},e.ATTRIBUTES_LIST=["skin","blemish","ear","head","mouth","neck","nose","eyes","facial-hair","mouth-accessory"],e.ATTRIBUTES={base:["male-alien","male-ape","male-zombie","male-human-lighter","male-human-light","male-human-dark","male-human-darker","female-alien","female-ape","female-zombie","female-human-lighter","female-human-light","female-human-dark","female-human-darker"],blemish:["mole","rosy-cheeks","spots"],ear:["earring"],eyes:["3d-glasses","big-shades","blue-eye-shadow","classic-shades","clown-eyes-blue","clown-eyes-green","eye-mask","eye-patch","green-eye-shadow","horned-rim-glasses","nerd-glasses","purple-eye-shadow","regular-shades","small-shades","vr","welding-goggles"],"facial-hair":["big-beard","chinstrap","front-beard","front-beard-dark","goat","handlebars","luxurious-beard","mustache","muttonchops","normal-beard","normal-beard-black","shadow-beard"],head:["bandana","beanie","blonde-bob","blonde-short","cap","cap-forward","clown-hair-green","cowboy-hat","crazy-hair","dark-hair","do-rag","fedora","frumpy-hair","half-shaved","headband","hoodie","knitted-cap","messy-hair","mohawk","mohawk-dark","mohawk-thin","orange-side","peak-spike","pigtails","pilot-helmet","pink-with-hat","police-cap","purple-hair","red-mohawk","shaved-head","straight-hair","straight-hair-blonde","straight-hair-dark","stringy-hair","tassle-hat","tiara","top-hat","vampire-hair","wild-blonde","wild-hair","wild-white-hair"],mouth:["black-lipstick","buck-teeth","frown","hot-lipstick","purple-lipstick","smile"],"mouth-accessory":["cigarette","pipe","vape","medical-mask"],neck:["choker","gold-chain","silver-chain"],nose:["clown-nose"]},e.isValidTokenId=(e=>{let n=!1;return isNaN(e)||(e=parseInt(e),e-=t,n=0<=e&&e<a.MALE+a.FEMALE),n}),e.labelize=(e=>e?e.replace(/-/g," ").replace(/(^\w{1})|(\s+\w{1})/g,e=>e.toUpperCase()):""),e.getTokenId=((o,i=!1)=>{const r=o.gender;let l="female"===r?a.MALE:0;const d=e.SPRITES[r],c=Object.keys(e.SPRITES[r]).sort(n);let u=1;for(let e=c.length-1;e>=0;e--){const t=c[e],a=o[t]||"none",n=Object.keys(d[t]).sort(s);let r=n.indexOf(a||null);if(r<0){if(!i)throw new Error(`"${a}" is not a valid value for attribute "${t}"`);r=0}l+=r*u;const h=n.length;u*=h}return l+t}),e.getPunkFromTokenId=(o=>{o-=t;const i={gender:null};o<a.MALE?i.gender="male":(i.gender="female",o-=a.MALE);const r=i.gender,l=e.SPRITES[r],d=Object.keys(e.SPRITES[r]).sort(n),c=[];let u=1;for(let e=d.length-1;e>=0;e--){const t=d[e],a=Object.keys(l[t]),n=a.length;c.unshift(u),u*=n}for(let e=0;e<d.length;e++){const t=d[e],a=c[e],n=Math.floor(o/a),r=Object.keys(l[t]).sort(s);i[t]=r[n],"none"===i[t]&&(i[t]=null),o-=n*a}return i})})("undefined"==typeof window?module.exports:window),(()=>{const e={API_ENDPOINT:"http://localhost:8080/api"},t="0x4",a="Select...",n={METAMASK_NOT_FOUND:'You need an Ethereum wallet to mint NFTs! You can download metamask <a target="_blank" href="https://metamask.io/download/">here</a>',MINTING_IN_PROGRESS:'<img src="/assets/img/loader.gif"><span>It can take a few seconds...</span>',MINT_SUCCESS:'Punks minted successfully! Click <a target="_blank" href="//rinkeby.etherscan.io/tx/{tx}">here</a> to check the transaction on etherscan'};let s=null;const o={gender:"male",skin:"human-light",blemish:null,ear:null,eyes:null,"facial-hair":null,head:null,mouth:null,"mouth-accessory":null,neck:null,nose:null},i={...o};let r=!1,l=!1,d=null,c=null,u=null;const h=document.querySelector("#modal"),m=h.querySelector("#modal .modal-content"),p=document.querySelector("#modalMessage"),g=document.querySelector("#modalMessage .modal-content"),w=Array.from(document.querySelectorAll(".combo")),y=document.querySelector("#btnCloseModal"),k=document.querySelector("#btnClosePunkViewer"),b=document.querySelector("#btnAddToCart"),v=document.querySelector("#btnConnectWallet"),f=document.querySelector("#btnMintFirstButton"),S=document.querySelector(".result"),T=document.querySelector("#cartItems"),E=document.querySelector("#btnMint"),I=document.querySelector("#closeMessageButton"),M=document.querySelector("#cartTotal"),$=document.querySelector(".wallet"),L=document.querySelector(".wallet-list"),A=document.querySelector(".builder"),q=document.querySelector("#punkViewer"),P=document.querySelector("#punkViewer .punk-viewer-item"),N=document.querySelector("#punkViewerTitle"),O=document.querySelector("#traitsList"),R=document.getElementById("favicon"),_=document.getElementById("currentPrice"),H=Array.from(document.querySelectorAll(".punk-grid-item")),z=()=>Array.from(T.querySelectorAll(".item")).map(e=>JSON.parse(decodeURIComponent(e.dataset.mintrequest))),C=async t=>{window.progress.start(),r=!0,K();let a=null;try{const n=await fetch(`${e.API_ENDPOINT}?method=getPunk&tokenId=${t}`);if(n.ok){const e=await n.json();debugger;return Z(e.state),e}a=await n.text()}catch(e){a=e.message}finally{r=!1,window.progress.stop(),K(a)}},j=(e,t,a,n)=>(a=a||"var(--punk--comboSize)",n=n||i.gender,e&&t?"gender"!==e?SPRITES[n][e]?`calc(-${SPRITES[n][e][t]} * ${a})`:null:`calc(-${SPRITES[t].skin[i.skin]} * ${a})`:null),F=(e,t=h)=>{e?(document.body.style.overflow="hidden",t.classList.add("visible")):(document.body.style.overflow="initial",t.classList.remove("visible"))},x=(e,t="success")=>{e?(document.body.style.overflow="hidden",p.dataset.type=t,p.classList.add("visible"),g.innerHTML=e):(document.body.style.overflow="initial",p.classList.remove("visible"),g.innerHTML="")},U=e=>{const t=e.dataset.combo,n=i[t];e.dataset.empty=!n;const s=j("skin",i.skin);e.innerHTML=`\n    <div class="layer-container" style="background-image:${["skin","gender"].includes(t)?"":"url('assets/img/sprites.png')"};background-position:${s}">\n        <img class="layer" src="assets/img/sprites.png" style="object-position:${j(t,n)}" />\n    </div>\n    <div class="label-container">\n        <div class="label-head">${window.labelize(e.dataset.combo)}</div>\n        <div class="label">${n?window.labelize(n):a}</div>\n    </div>`,e.addEventListener("click",()=>{document.body.style.overflow="hidden";const e=j("skin",i.skin);let a=null;a="gender"===t?{male:window.SPRITES.male.skin[i.skin],female:window.SPRITES.female.skin[i.skin]}:window.SPRITES[i.gender][t];let n='<div class="options">';Object.keys(a).map(e=>({id:e,pos:a[e]})).forEach(a=>{let s=!1;"none"!==a.id||"none"!==i[t]&&i[t]?"none"!==a.id&&SPRITES[i.gender][t]&&SPRITES[i.gender][t][a.id]&&(s=i[t]===a.id):s=!0,n+=`<div data-id="${a.id}" data-empty="${"none"===a.id}" data-selected="${s}" class="option" onclick="selectSprite('${t}','${a.id}')">\n                <div class="layer-container" style="background-image:${["skin","gender"].includes(t)?"":"url('assets/img/sprites.png')"};background-position:${e}">\n                    <img class="layer" src="assets/img/sprites.png" style="object-position:${j(t,a.id)}" />\n                </div>\n                <div class="label">${window.labelize(a.id)}</div>\n            </div>`}),n+="</div>",m.innerHTML=n,F(!0)})},D=()=>{const e=j("skin",i.skin);w.forEach(t=>{const n=t.dataset.combo,s=i.gender,o=i[n],r="gender"!==n&&!window.SPRITES[s][n];t.dataset.hidden=r;const l=!o||"none"===o;t.dataset.empty=l;const d=t.querySelector(".layer"),c=t.querySelector(".label");d.style=`object-position:${j(n,o)}`,d.dataset.empty=l,c.innerHTML=l?a:window.labelize(o);const u=t.querySelector(".layer-container");if(u.style.backgroundPosition=e,"gender"===n)newPos=e;else if(i[n]&&SPRITES[s][n]&&void 0!==SPRITES[s][n][i[n]])newPos=j(n,i[n]);else{t.dataset.empty="true",newPos=j(n,null);const e=t.querySelector(".label");e.innerHTML=a}t.querySelector(".layer").style.objectPosition=newPos})},B=({node:e,state:t,imgSelector:a,size:n}={})=>{e=e||S,t=t||i,a=a||".result > img",n=n||"var(--punk--result)",t===i&&(e.dataset.tokenid=window.getTokenId(i,!0));const s=Array.from(document.querySelectorAll(a));s.forEach(e=>{if(t[e.dataset.layer]&&"none"!==t[e.dataset.layer]&&window.SPRITES[t.gender][e.dataset.layer]&&void 0!==window.SPRITES[t.gender][e.dataset.layer][t[e.dataset.layer]]){e.dataset.empty="false";const a=j(e.dataset.layer,t[e.dataset.layer],n,t.gender);a?e.style.objectPosition=a:e.dataset.empty="true"}else e.dataset.empty="true"})},K=e=>{e&&x(e,"error");const t=parseInt(S.dataset.tokenid),a=z();r||l?(b.setAttribute("disabled",""),r&&(b.innerHTML="Loading...")):(b.innerHTML="Add to cart",a.find(e=>e.id===t)?b.setAttribute("disabled",""):b.removeAttribute("disabled")),a.length?l?(E.classList.remove("hidden"),E.setAttribute("disabled",""),E.innerHTML="Minting..."):(E.innerHTML=`Mint ${a.length} punk${a.length>1?"s":""}`,E.classList.remove("hidden"),E.removeAttribute("disabled")):E.classList.add("hidden");let n=0;a.forEach(e=>n+=e.price),M.innerHTML=Math.round(1e3*parseFloat(n/1e9))/1e3},V=()=>{const e=parseInt(S.dataset.tokenid),t=z();e&&!t.includes(t=>e===t.id)&&(async()=>{const t=await C(e);if(t){const a=`https://infura-ipfs.io/ipfs/${t.imageCid}`;T.insertAdjacentHTML("beforeend",`<div data-tokenid="${t.tokenId}" data-price="${t.price}" data-mintrequest="${encodeURIComponent(JSON.stringify(t.mintRequest))}" class="item" title="#${t.tokenId}">\n              <a href="#${t.tokenId}" class="img-container"><img src="${a}" /></a>\n              <button>Remove</button>\n            </div>`),R.setAttribute("href",a),R.dataset.updated="true",K(),Object.assign(i,o),D(),B();const n=T.querySelector(`[data-tokenid="${e}"] > button`);n&&n.addEventListener("click",()=>{const t=T.querySelector(`[data-tokenid="${e}"]`);t&&t.remove(),K()})}})()},G=async()=>{let e=null;try{const t=await J(!0);if("not-found"===t)x(n.METAMASK_NOT_FOUND,"error");else if("connected"===t){if(c){const e=z();if(e.length){window.progress.start(),l=!0,K();const t=e.reduce((e,t)=>e+t.price,0);let a=await c.methods.mint(e).estimateGas({from:u});a+=Math.floor(.1*a);const s=await c.methods.mint(e).send({from:u,gas:a.toString(),value:d.utils.toWei(t.toString(),"gwei")}).once("transactionHash",()=>{x(n.MINTING_IN_PROGRESS,"mint")});x(n.MINT_SUCCESS.replace("{tx}",s.transactionHash)),T.innerHTML="",X()}}}else await J()}catch(t){e=t.message}finally{l=!1,window.progress.stop(),K(e)}},W=async()=>{const e=await J(!0);"not-found"===e&&x(n.METAMASK_NOT_FOUND,"error")},J=async a=>{window.progress.start();try{let n="not-found",o=Web3.givenProvider;if(!s){const t=await fetch(`${e.API_ENDPOINT}?method=getContract`);if(t.ok)s=await t.json(),Z(s.state);else{const e=await t.text();if(e)throw new Error(e)}}if(o){d||(d=new Web3(o),o.on("connect",()=>J()),o.on("disconnect",()=>J()),o.on("chainChanged",()=>J()),o.on("accountsChanged",()=>J()));const e=await d.eth.getAccounts();if(u=e[0],!u&&a){const e=await o.request({method:"eth_requestAccounts"});u=e[0]}if(u){const e=await o.request({method:"eth_chainId"});e!==t?(n="invalid-chain",a&&await o.request({method:"wallet_switchEthereumChain",params:[{chainId:t}]})):(c||(c=new d.eth.Contract(s.abi,s.address)),c&&(n="connected"))}else n="disconnected"}return document.querySelector("body").dataset.web3=n,await X(),n}catch(e){x(e.message,"error")}finally{window.progress.stop()}},X=async()=>{if(c){$.dataset.status="loading";try{const e=[];let t=!1,a="";const n=S.innerHTML;do{let s=null;try{debugger;s=await c.methods.tokenOfOwnerByIndex(u,e.length).call({from:u});const o=window.getPunkFromTokenId(parseInt(s));a+=`<div onclick="window.openOpenSea('${s}')" title="#${s}" class="wallet-item-container"><div data-tokenid="${s}" data-walletitem="${e.length}" class="wallet-item">${n}</div><div class="wallet-item-tokenid">${s}</div></div>`,e.push({...o,base:`${o.gender}-${o.skin}`})}catch(e){t=!0}}while(!t);L.innerHTML=a,setTimeout(()=>{const t=Array.from(document.querySelectorAll(".wallet-item"));t.forEach((t,a)=>{const n=e[a],s="var(--punk--cartSize)",o=t,i=`[data-walletitem="${a}"] > img`;B({node:o,state:n,imgSelector:i,size:s})}),$.dataset.status=t.length?"connected":"empty"})}catch(e){$.dataset.status="disconnected",x(e.message,"error")}}else $.dataset.status="disconnected"},Y=()=>{const e=window.location.hash;let t=!1;if(e&&/^#[0-9]+$/.test(e))try{const a=parseInt(e.replace("#",""));if(a>=window.MIN_TOKENID&&a<=MAX_TOKENID){N.innerHTML=a,P.innerHTML=S.innerHTML;const e=window.getPunkFromTokenId(a),n={...e,base:`${e.gender}-${e.skin}`},s="var(--punk--result)",o=P,i=".punk-viewer-item > img";B({node:o,state:n,imgSelector:i,size:s});let r="";["gender",...window.ATTRIBUTES_LIST].forEach(t=>{e[t]&&(r+=`<div class="punk-viewer-traits-item"><div>${window.labelize(t)}</div><div>${window.labelize(e[t])}</div></div>`)}),O.innerHTML=r,t=!0}}catch(t){console.error(`invalid hash => ${e}`)}F(t,q)},Q=()=>{F(!1),F(!1,q),x(null),window.history.pushState(null,null," ")},Z=e=>{s&&(s.state=e,_.innerHTML=`${Math.round(1e3*s.state.price)/1e3} ETH`)};window.addEventListener("keydown",e=>{"Escape"===e.key&&Q()}),window.selectSprite=((e,t)=>{i[e]=t,B();const a=Array.from(h.querySelectorAll(".option"));a.forEach(e=>e.dataset.selected=e.dataset.id===t),F(!1),document.body.style.overflow="initial",D(),K()}),window.openOpenSea=(e=>{window.open(`https://testnets.opensea.io/assets/${c._address}/${e}`,"_blank").focus()}),window.openPriceEvolution=(()=>{const e=`\n    <div data-active="false" class="price-evolution">\n      <div class="chart-container">\n        <img src="/assets/img/chart.svg" />\n        <div class="chart-line" style="left:${100*Math.max(.01,Math.round(s.state.supply/1e6))}%"></div>\n      </div>\n      <div class="chart-table">\n        ${[...s.state.priceEvolution,[s.state.supply,s.state.price]].sort((e,t)=>e[0]-t[0]).map(e=>`\n            <div data-current="${e[0]===s.state.supply?"true":"false"}" class="chart-table-item">\n              <div class="chart-table-item-label">#${e[0].toLocaleString()}</div>\n              <div class="sep"></div>\n              <div class="chart-table-item-price">${(e[1]<10?Math.round(1e3*e[1])/1e3:Math.round(e[1])).toLocaleString()} ETH\n              </div>\n            </div>`).join("")}\n      </div>\n      <div class="chart-legend">\n            <span>*</span> current price\n      </div>\n    </div>`;x(e,"price"),setTimeout(()=>{const e=document.querySelector(".price-evolution");e&&(e.dataset.active="true")},100)}),window.onWeb3Loaded=(async()=>J()),window.addEventListener("hashchange",Y),w.forEach(e=>U(e)),b.addEventListener("click",V),E.addEventListener("click",G),v.addEventListener("click",W),f.addEventListener("click",()=>A.scrollIntoView({behavior:"smooth"})),y.addEventListener("click",Q),k.addEventListener("click",Q),I.addEventListener("click",()=>x(null)),B(),Y();let ee=1;(function e(){R.dataset.updated||(R.setAttribute("href",`/assets/img/favicon/${ee}.png`),ee++,ee>9&&(ee=0)),H.forEach(e=>{e.dataset.initialized||(e.innerHTML=S.innerHTML,e.dataset.initialized="true");const t=Math.floor(36e6*Math.random()),a=window.getPunkFromTokenId(t),n="var(--punk--cartSize)",s=e,o=`[data-griditem="${e.dataset.griditem}"] > img`;B({node:s,state:a,imgSelector:o,size:n})}),setTimeout(e,1e3)})()})(),(e=>{const t=200;let a=!1;const n=()=>{if(a){const t=(100-a.dataset.value)*(.1*Math.random());a.dataset.value=parseFloat(a.dataset.value)+t,a.style.width=`${a.dataset.value}%`,e.requestAnimationFrame(n.bind(null,a))}};e.progress={start(){a&&document.body.removeChild(a),a=document.createElement("div"),a.id="progress",a.dataset.value=0,document.body.appendChild(a),n(a)},stop:async()=>new Promise(n=>{const s=a;a=null,e.requestAnimationFrame(()=>{s&&(s.style.width="100%",setTimeout(()=>{document.body.removeChild(s),n()},t))})})}})(window);
