(function(e){const t=1e4,a={MALE:29527680,FEMALE:6092800};e.MAX_TOKENID=a.MALE+a.FEMALE-1,e.MIN_TOKENID=t;const n=(e,t)=>e.localeCompare(t),o=(e,t)=>e===t?0:"none"===e?-1:"none"===t?1:e.localeCompare(t);e.SPRITES={male:{skin:{alien:1,ape:3,zombie:13,"human-lighter":11,"human-light":10,"human-dark":8,"human-darker":9},blemish:{none:null,mole:84,"rosy-cheeks":85,spots:86},ear:{none:null,earring:87},eyes:{none:null,"3d-glasses":88,"big-shades":89,"classic-shades":90,"clown-eyes-blue":91,"clown-eyes-green":92,"eye-mask":93,"eye-patch":94,"horned-rim-glasses":95,"nerd-glasses":96,"regular-shades":97,"small-shades":98,vr:99},"facial-hair":{none:null,"big-beard":100,chinstrap:101,"front-beard-dark":102,"front-beard":103,goat:104,handlebars:105,"luxurious-beard":106,mustache:107,muttonchops:108,"normal-beard-black":109,"normal-beard":110,"shadow-beard":111},head:{none:null,bandana:112,beanie:113,"cap-forward":114,cap:115,"clown-hair-green":116,"cowboy-hat":117,"crazy-hair":118,"do-rag":119,fedora:120,"frumpy-hair":121,headband:122,hoodie:123,"knitted-cap":124,"messy-hair":125,"mohawk-dark":126,"mohawk-thin":127,mohawk:128,"peak-spike":129,"police-cap":130,"purple-hair":131,"shaved-head":132,"stringy-hair":133,"top-hat":134,"vampire-hair":135,"wild-hair":136},mouth:{none:null,"buck-teeth":137,smile:143,frown:141},"mouth-accessory":{none:null,cigarette:138,pipe:139,vape:140,"medical-mask":142},neck:{none:null,"gold-chain":144,"silver-chain":145},nose:{none:null,"clown-nose":146}},female:{skin:{alien:0,ape:2,zombie:12,"human-lighter":7,"human-light":6,"human-dark":4,"human-darker":5},blemish:{none:null,mole:14,"rosy-cheeks":15,spots:16},ear:{none:null,earring:17},eyes:{none:null,"3d-glasses":18,"big-shades":19,"blue-eye-shadow":20,"classic-shades":21,"clown-eyes-blue":22,"clown-eyes-green":23,"eye-mask":24,"eye-patch":25,"green-eye-shadow":26,"horned-rim-glasses":27,"nerd-glasses":28,"purple-eye-shadow":29,"regular-shades":30,"small-shades":31,vr:32,"welding-goggles":33},head:{none:null,bandana:34,beanie:35,"blonde-bob":36,"blonde-short":37,"cap-forward":38,cap:39,"clown-hair-green":40,"cowboy-hat":41,"crazy-hair":42,"dark-hair":43,"do-rag":44,fedora:45,"frumpy-hair":46,"half-shaved":47,headband:48,hoodie:49,"knitted-cap":50,"messy-hair":51,"mohawk-thin":52,"mohawk-dark":53,mohawk:54,"orange-side":55,pigtails:56,"pilot-helmet":57,"pink-with-hat":58,"police-cap":59,"purple-hair":60,"red-mohawk":61,"shaved-head":62,"straight-hair-blonde":63,"straight-hair-dark":64,"straight-hair":65,"stringy-hair":66,"tassle-hat":67,tiara:82,"top-hat":68,"wild-blonde":69,"wild-hair":70,"wild-white-hair":71},mouth:{none:null,"black-lipstick":75,"hot-lipstick":76,"purple-lipstick":78},"mouth-accessory":{none:null,cigarette:72,pipe:73,vape:74,"medical-mask":77},neck:{none:null,choker:79,"gold-chain":80,"silver-chain":81},nose:{none:null,"clown-nose":83}}},e.ATTRIBUTES_LIST=["skin","blemish","ear","head","mouth","neck","nose","eyes","facial-hair","mouth-accessory"],e.ATTRIBUTES={base:["male-alien","male-ape","male-zombie","male-human-lighter","male-human-light","male-human-dark","male-human-darker","female-alien","female-ape","female-zombie","female-human-lighter","female-human-light","female-human-dark","female-human-darker"],blemish:["mole","rosy-cheeks","spots"],ear:["earring"],eyes:["3d-glasses","big-shades","blue-eye-shadow","classic-shades","clown-eyes-blue","clown-eyes-green","eye-mask","eye-patch","green-eye-shadow","horned-rim-glasses","nerd-glasses","purple-eye-shadow","regular-shades","small-shades","vr","welding-goggles"],"facial-hair":["big-beard","chinstrap","front-beard","front-beard-dark","goat","handlebars","luxurious-beard","mustache","muttonchops","normal-beard","normal-beard-black","shadow-beard"],head:["bandana","beanie","blonde-bob","blonde-short","cap","cap-forward","clown-hair-green","cowboy-hat","crazy-hair","dark-hair","do-rag","fedora","frumpy-hair","half-shaved","headband","hoodie","knitted-cap","messy-hair","mohawk","mohawk-dark","mohawk-thin","orange-side","peak-spike","pigtails","pilot-helmet","pink-with-hat","police-cap","purple-hair","red-mohawk","shaved-head","straight-hair","straight-hair-blonde","straight-hair-dark","stringy-hair","tassle-hat","tiara","top-hat","vampire-hair","wild-blonde","wild-hair","wild-white-hair"],mouth:["black-lipstick","buck-teeth","frown","hot-lipstick","purple-lipstick","smile"],"mouth-accessory":["cigarette","pipe","vape","medical-mask"],neck:["choker","gold-chain","silver-chain"],nose:["clown-nose"]},e.isValidTokenId=(e=>{let n=!1;return isNaN(e)||(e=parseInt(e),e-=t,n=0<=e&&e<a.MALE+a.FEMALE),n}),e.labelize=(e=>e?e.replace(/-/g," ").replace(/(^\w{1})|(\s+\w{1})/g,e=>e.toUpperCase()):""),e.getTokenId=((s,i=!1)=>{const r=s.gender;let l="female"===r?a.MALE:0;const d=e.SPRITES[r],c=Object.keys(e.SPRITES[r]).sort(n);let h=1;for(let e=c.length-1;e>=0;e--){const t=c[e],a=s[t]||"none",n=Object.keys(d[t]).sort(o);let r=n.indexOf(a||null);if(r<0){if(!i)throw new Error(`"${a}" is not a valid value for attribute "${t}"`);r=0}l+=r*h;const u=n.length;h*=u}return l+t}),e.getPunkFromTokenId=(s=>{s-=t;const i={gender:null};s<a.MALE?i.gender="male":(i.gender="female",s-=a.MALE);const r=i.gender,l=e.SPRITES[r],d=Object.keys(e.SPRITES[r]).sort(n),c=[];let h=1;for(let e=d.length-1;e>=0;e--){const t=d[e],a=Object.keys(l[t]),n=a.length;c.unshift(h),h*=n}for(let e=0;e<d.length;e++){const t=d[e],a=c[e],n=Math.floor(s/a),r=Object.keys(l[t]).sort(o);i[t]=r[n],"none"===i[t]&&(i[t]=null),s-=n*a}return i})})("undefined"==typeof window?module.exports:window),(()=>{const e={API_ENDPOINT:"https://europe-west1-unlisted-punks.cloudfunctions.net/api"},t="0x4",a="Select...",n={METAMASK_NOT_FOUND:'You need an Ethereum wallet to mint NFTs! You can download metamask <a target="_blank" href="https://metamask.io/download/">here</a>',MINTING_IN_PROGRESS:'<img src="/assets/img/loader.gif"><span>It can take a few seconds...</span>',MINT_SUCCESS:'Punks minted successfully! Click <a target="_blank" href="//rinkeby.etherscan.io/tx/{tx}">here</a> to check the transaction on etherscan'},o={gender:"male",skin:"human-light",blemish:null,ear:null,eyes:null,"facial-hair":null,head:null,mouth:null,"mouth-accessory":null,neck:null,nose:null},s={...o};let i=!1,r=null,l=null,d=null;const c=document.querySelector("#modal"),h=c.querySelector("#modal .modal-content"),u=document.querySelector("#modalMessage"),m=document.querySelector("#modalMessage .modal-content"),g=Array.from(document.querySelectorAll(".combo")),w=document.querySelector("#btnCloseModal"),p=document.querySelector("#btnClosePunkViewer"),y=document.querySelector("#btnAddToCart"),b=document.querySelector("#btnConnectWallet"),k=document.querySelector("#btnMintFirstButton"),v=document.querySelector(".result"),f=document.querySelector("#cartItems"),S=document.querySelector("#btnMint"),T=document.querySelector("#closeMessageButton"),E=document.querySelector("#cartTotal"),I=document.querySelector(".wallet"),$=document.querySelector(".wallet-list"),M=document.querySelector(".builder"),L=document.querySelector("#punkViewer"),P=document.querySelector("#punkViewer .punk-viewer-item"),A=document.querySelector("#punkViewerTitle"),q=document.querySelector("#traitsList"),N=document.getElementById("favicon"),R=()=>Array.from(f.querySelectorAll(".item")).map(e=>JSON.parse(decodeURIComponent(e.dataset.mintrequest))),O=async t=>{window.progress.start(),i=!0,W();let a=null;try{const n=await fetch(`${e.API_ENDPOINT}?method=getPunk&tokenId=${t}`);if(n.ok){const e=await n.json();return e}a=await n.text()}catch(e){a=e.message}finally{i=!1,window.progress.stop(),W(a)}},_=(e,t,a,n)=>(a=a||"var(--punk--comboSize)",n=n||s.gender,e&&t?"gender"!==e?SPRITES[n][e]?`calc(-${SPRITES[n][e][t]} * ${a})`:null:`calc(-${SPRITES[t].skin[s.skin]} * ${a})`:null),C=(e,t=c)=>{e?(document.body.style.overflow="hidden",t.classList.add("visible")):(document.body.style.overflow="initial",t.classList.remove("visible"))},H=(e,t="success")=>{e?(document.body.style.overflow="hidden",u.dataset.type=t,u.classList.add("visible"),m.innerHTML=e):(document.body.style.overflow="initial",u.classList.remove("visible"),m.innerHTML="")},z=e=>{const t=e.dataset.combo,n=s[t];e.dataset.empty=!n;const o=_("skin",s.skin);e.innerHTML=`\n    <div class="layer-container" style="background-image:${["skin","gender"].includes(t)?"":"url('assets/img/sprites.png')"};background-position:${o}">\n        <img class="layer" src="assets/img/sprites.png" style="object-position:${_(t,n)}" />\n    </div>\n    <div class="label-container">\n        <div class="label-head">${window.labelize(e.dataset.combo)}</div>\n        <div class="label">${n?window.labelize(n):a}</div>\n    </div>`,e.addEventListener("click",()=>{document.body.style.overflow="hidden";const e=_("skin",s.skin);let a=null;a="gender"===t?{male:window.SPRITES.male.skin[s.skin],female:window.SPRITES.female.skin[s.skin]}:window.SPRITES[s.gender][t];let n='<div class="options">';Object.keys(a).map(e=>({id:e,pos:a[e]})).forEach(a=>{let o=!1;"none"!==a.id||"none"!==s[t]&&s[t]?"none"!==a.id&&SPRITES[s.gender][t]&&SPRITES[s.gender][t][a.id]&&(o=s[t]===a.id):o=!0,n+=`<div data-id="${a.id}" data-empty="${"none"===a.id}" data-selected="${o}" class="option" onclick="selectSprite('${t}','${a.id}')">\n                <div class="layer-container" style="background-image:${["skin","gender"].includes(t)?"":"url('assets/img/sprites.png')"};background-position:${e}">\n                    <img class="layer" src="assets/img/sprites.png" style="object-position:${_(t,a.id)}" />\n                </div>\n                <div class="label">${window.labelize(a.id)}</div>\n            </div>`}),n+="</div>",h.innerHTML=n,C(!0)})},j=()=>{const e=_("skin",s.skin);g.forEach(t=>{const n=t.dataset.combo,o=s.gender,i=s[n],r="gender"!==n&&!window.SPRITES[o][n];t.dataset.hidden=r;const l=!i||"none"===i;t.dataset.empty=l;const d=t.querySelector(".layer"),c=t.querySelector(".label");d.style=`object-position:${_(n,i)}`,d.dataset.empty=l,c.innerHTML=l?a:window.labelize(i);const h=t.querySelector(".layer-container");if(h.style.backgroundPosition=e,"gender"===n)newPos=e;else if(s[n]&&SPRITES[o][n]&&void 0!==SPRITES[o][n][s[n]])newPos=_(n,s[n]);else{t.dataset.empty="true",newPos=_(n,null);const e=t.querySelector(".label");e.innerHTML=a}t.querySelector(".layer").style.objectPosition=newPos})},F=({node:e,state:t,imgSelector:a,size:n}={})=>{e=e||v,t=t||s,a=a||".result > img",n=n||"var(--punk--result)",t===s&&(e.dataset.tokenid=window.getTokenId(s,!0));const o=Array.from(document.querySelectorAll(a));o.forEach(e=>{if(t[e.dataset.layer]&&"none"!==t[e.dataset.layer]&&window.SPRITES[t.gender][e.dataset.layer]&&void 0!==window.SPRITES[t.gender][e.dataset.layer][t[e.dataset.layer]]){e.dataset.empty="false";const a=_(e.dataset.layer,t[e.dataset.layer],n,t.gender);a?e.style.objectPosition=a:e.dataset.empty="true"}else e.dataset.empty="true"})},W=e=>{e&&H(e,"error");const t=parseInt(v.dataset.tokenid),a=R();i?(y.setAttribute("disabled",""),y.innerHTML="Loading..."):(y.innerHTML="Add to cart",a.find(e=>e.id===t)?y.setAttribute("disabled",""):y.removeAttribute("disabled")),a.length?(S.innerHTML=`Mint ${a.length} punk${a.length>1?"s":""}`,S.classList.remove("hidden"),i?S.setAttribute("disabled",""):S.removeAttribute("disabled")):S.classList.add("hidden");let n=0;a.forEach(e=>n+=e.price),E.innerHTML=parseFloat(n/1e9)},x=()=>{const e=parseInt(v.dataset.tokenid),t=R();e&&!t.includes(t=>e===t.id)&&(async()=>{const t=await O(e);if(t){const a=`https://infura-ipfs.io/ipfs/${t.imageCid}`;f.insertAdjacentHTML("beforeend",`<div data-tokenid="${t.tokenId}" data-price="${t.price}" data-mintrequest="${encodeURIComponent(JSON.stringify(t.mintRequest))}" class="item" title="#${t.tokenId}">\n              <a href="#${t.tokenId}" class="img-container"><img src="${a}" /></a>\n              <button>Remove</button>\n            </div>`),N.setAttribute("href",a),N.dataset.updated="true",W(),Object.assign(s,o),j(),F();const n=f.querySelector(`[data-tokenid="${e}"] > button`);n&&n.addEventListener("click",()=>{const t=f.querySelector(`[data-tokenid="${e}"]`);t&&t.remove(),W()})}})()},U=async()=>{let e=null;try{const t=await B(!0);if("not-found"===t)H(n.METAMASK_NOT_FOUND,"error");else if("connected"===t){if(l){const e=R();if(e.length){window.progress.start(),i=!0,W();const t=e.reduce((e,t)=>e+t.price,0);let a=await l.methods.mint(e).estimateGas({from:d});a+=Math.floor(.1*a);const o=await l.methods.mint(e).send({from:d,gas:a.toString(),value:r.utils.toWei(t.toString(),"gwei")}).once("transactionHash",()=>{H(n.MINTING_IN_PROGRESS,"mint")});H(n.MINT_SUCCESS.replace("{tx}",o.transactionHash)),f.innerHTML="",K()}}}else await B()}catch(t){e=t.message}finally{i=!1,window.progress.stop(),W(e)}},D=async()=>{const e=await B(!0);"not-found"===e&&H(n.METAMASK_NOT_FOUND,"error")},B=async a=>{window.progress.start();try{let n="not-found";if(Web3.givenProvider){r||(r=new Web3(Web3.givenProvider),Web3.givenProvider.on("connect",()=>B()),Web3.givenProvider.on("disconnect",()=>B()),Web3.givenProvider.on("chainChanged",()=>B()),Web3.givenProvider.on("accountsChanged",()=>B()));const o=await r.eth.getAccounts();if(d=o[0],!d&&a){const e=await Web3.givenProvider.request({method:"eth_requestAccounts"});d=e[0]}if(d){const o=await Web3.givenProvider.request({method:"eth_chainId"});if(o!==t)n="invalid-chain",a&&await Web3.givenProvider.request({method:"wallet_switchEthereumChain",params:[{chainId:t}]});else{if(!l){const t=await fetch(`${e.API_ENDPOINT}?method=getContract`);if(t.ok){const e=await t.json();l=new r.eth.Contract(e.abi,e.address)}else{const e=await t.text();if(e)throw new Error(e)}}l&&(n="connected")}}else n="disconnected"}return document.querySelector("body").dataset.web3=n,await K(),n}catch(e){H(e.message,"error")}finally{window.progress.stop()}},K=async()=>{if(l){I.dataset.status="loading";try{const e=[];let t=!1,a="";const n=v.innerHTML;do{let o=null;try{o=await l.methods.tokenOfOwnerByIndex(d,e.length).call({from:d});const s=window.getPunkFromTokenId(parseInt(o));a+=`<a href="#${o}" title="#${o}" class="wallet-item-container"><div data-tokenid="${o}" data-walletitem="${e.length}" class="wallet-item">${n}</div><div class="wallet-item-tokenid">${o}</div></a>`,e.push({...s,base:`${s.gender}-${s.skin}`})}catch(e){t=!0}}while(!t);$.innerHTML=a,setTimeout(()=>{const t=Array.from(document.querySelectorAll(".wallet-item"));t.forEach((t,a)=>{const n=e[a],o="var(--punk--cartSize)",s=t,i=`[data-walletitem="${a}"] > img`;F({node:s,state:n,imgSelector:i,size:o})}),I.dataset.status=t.length?"connected":"empty"})}catch(e){I.dataset.status="disconnected",H(e.message,"error")}}else I.dataset.status="disconnected"},V=()=>{const e=window.location.hash;let t=!1;if(e&&/^#[0-9]+$/.test(e))try{const a=parseInt(e.replace("#",""));if(a>=window.MIN_TOKENID&&a<=MAX_TOKENID){A.innerHTML=a,P.innerHTML=v.innerHTML;const e=window.getPunkFromTokenId(a),n={...e,base:`${e.gender}-${e.skin}`},o="var(--punk--result)",s=P,i=".punk-viewer-item > img";F({node:s,state:n,imgSelector:i,size:o});let r="";["gender",...window.ATTRIBUTES_LIST].forEach(t=>{e[t]&&(r+=`<div class="punk-viewer-traits-item"><div>${window.labelize(t)}</div><div>${window.labelize(e[t])}</div></div>`)}),q.innerHTML=r,t=!0}}catch(t){console.error(`invalid hash => ${e}`)}C(t,L)},G=()=>{C(!1),C(!1,L),window.history.pushState(null,null," ")};window.addEventListener("keydown",e=>{"Escape"===e.key&&G()}),window.selectSprite=((e,t)=>{s[e]=t,F();const a=Array.from(c.querySelectorAll(".option"));a.forEach(e=>e.dataset.selected=e.dataset.id===t),C(!1),document.body.style.overflow="initial",j(),W()}),window.onWeb3Loaded=(async()=>B()),window.addEventListener("hashchange",V),g.forEach(e=>z(e)),y.addEventListener("click",x),S.addEventListener("click",U),b.addEventListener("click",D),k.addEventListener("click",()=>M.scrollIntoView({behavior:"smooth"})),w.addEventListener("click",G),p.addEventListener("click",G),T.addEventListener("click",()=>H(null)),F(),V();let J=1,X=setInterval(()=>{N.dataset.updated?X&&clearInterval(X):(N.setAttribute("href",`/assets/img/favicon/${J}.png`),J++,J>9&&(J=0))},1e3)})(),(e=>{const t=200;let a=!1;const n=()=>{if(a){const t=(100-a.dataset.value)*(.1*Math.random());a.dataset.value=parseFloat(a.dataset.value)+t,a.style.width=`${a.dataset.value}%`,e.requestAnimationFrame(n.bind(null,a))}};e.progress={start(){a&&document.body.removeChild(a),a=document.createElement("div"),a.id="progress",a.dataset.value=0,document.body.appendChild(a),n(a)},stop:async()=>new Promise(n=>{const o=a;a=null,e.requestAnimationFrame(()=>{o&&(o.style.width="100%",setTimeout(()=>{document.body.removeChild(o),n()},t))})})}})(window);
